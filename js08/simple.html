<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>Firebase_version9_RealtimeDB(G'sACADEMY初学者用サンプル)</title>
<link rel="stylesheet" href="css/sample.css">

</head>
<body>

<h1>Real Time Chat</h1>
<!-- コンテンツ表示画面 -->

<div>
    <div id="output" style="overflow: auto; height: 300px;"></div>
    <div id="name1">
        <p>Name</p><input type="text" id="uname" size="52">
    </div>
    <div>
        <textarea id="text" cols="50" rows="10"></textarea><br>
        <button id="send">send</button>
    </div>

</div>
<!--/ コンテンツ表示画面 -->



<!-- JQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<!-- JQuery -->


<!--** 以下Firebase **-->
<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.5.0/firebase-app.js";
    //これ入れなきゃ動かない！！！！
    import { getDatabase, ref, push, set, onChildAdded, remove, onChildRemoved } 
    from "https://www.gstatic.com/firebasejs/9.5.0/firebase-database.js";//バージョンを同じにする

    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDpGfAsMc4ytCcFhNPaFngpwlFiJ1W8JEQ",
      authDomain: "sample-aa5a2.firebaseapp.com",
      projectId: "sample-aa5a2",
      storageBucket: "sample-aa5a2.appspot.com",
      messagingSenderId: "326605540769",
      appId: "1:326605540769:web:7dfe3846c52a853ffbcfe0"
    };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);//firebaseにアクセス、接続
    const db  = getDatabase(app);//リアルタイムデータベースに接続
    const dbRef = ref(db,"chat");//階層を指定

    $("#send").on("click",function(){
        const msg = {
            uname : $("#uname").val(),
            text : $("#text").val(),
        };   
        const newPostRef = push (dbRef);//ユニークキーを生成
        set(newPostRef,msg);

    });
    
    onChildAdded(dbRef,function(data){
        const msg = data.val();
        const key = data.key;
        let h = '<div id = "kaiwa">'
            h += '<p>';
            h += '<div id = "namae">'
            h += msg.uname;
            h += '</div>'
            h += '<div id = "aikon">'
            h += msg.text;
            h += '</div>'
            h += '</p>';
            h += '</div>'
            $("#output").append(h);
    })

    $("#output").on("change",function(){
        scrollToBottom();
        })
    



    // const btn = document.getElementById('btn');

// btn.addEventListener('click', ()=>{
//     //リストを取得
//     const list = document.getElementById('list');
//     //リストアイテムを挿入
//     list.insertAdjacentHTML('beforeend', '<li>ADD ITEM</li>');
//     //スクロールバーの位置をリストの最下部に設定
//     list.scrollTo(0, list.scrollHeight);
// }, false);

    // $("#btn").on("click",function(){   
    //     const list = $("#output").get(0);

    // const results = ['大吉','中吉','凶'];
    // const n = Math.floor(Math.random()*results.length);
    // $("#btn").html(results[n]);


  </script>











</body>
</html>
































